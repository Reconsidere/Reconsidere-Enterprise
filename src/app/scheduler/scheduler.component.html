<app-toolbar></app-toolbar>
<div class="container">
  <div
    *ngIf="message"
    class="alert alert-warning alert-dismissible fade show"
    role="alert"
  >
    <strong>Atenção: </strong> {{ message }}
    <button
      type="button"
      (click)="closeMessage()"
      class="close"
      data-dismiss="alert"
      aria-label="Close"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="tableScheduler">
    <table class="table table-sm">
      <ng-template
        ngFor
        let-route
        [ngForOf]="georoutes | paginate: { itemsPerPage: 5, currentPage: page }"
        let-i="index"
      >
        <thead>
          <tr>
            <button
              id="newRoute"
              (click)="newRoute()"
              type="button"
              class="btn btn-sm btn-primary"
              data-toggle="button"
              aria-pressed="false"
              autocomplete="off"
            >
              <i class="fa fa-plus"></i>
            </button>
          </tr>
          <tr id="Titles">
            <th>Nome</th>
          </tr>
          <tr>
            <td hidden>{{ route._id }}</td>
            <td>
              <input
                class="form-control"
                type="text"
                [(ngModel)]="route.name"
                required
              />
            </td>

            <td class="tdStyle">
              <button
                (click)="expand(route)"
                type="button"
                class="btn btn-sm btn-primary ml-1"
                data-toggle="button"
                aria-pressed="false"
                autocomplete="off"
              >
                <i class="fa fa-caret-down"></i>
              </button>
              <button
                (click)="addScheduler(route)"
                type="button"
                class="btn btn-sm btn-primary ml-1"
                data-toggle="button"
                aria-pressed="false"
                autocomplete="off"
              >
                <i class="fa fa-plus"></i>
              </button>
            </td>
          </tr>
          <tr>
            <th colspan="1"></th>
            <th>
              <input
                #filterSearch
                (input)="(filterSearch)"
                name="carPlate"
                type="text"
                class="inputFilter"
              />
            </th>
            <th>
              <p-calendar
                name="startDate"
                dateFormat="dd/mm/yy"
                #filterSearch
                (input)="(filterSearch)"
                [readonlyInput]="true"
              ></p-calendar>
            </th>
            <th>
              <p-calendar
                name="endDate"
                dateFormat="dd/mm/yy"
                #filterSearch
                (input)="(filterSearch)"
                [readonlyInput]="true"
              ></p-calendar>
            </th>
            <th>
              <p-calendar
                name="startTime"
                pattern="HH:mm"
                timeOnly="true"
                hourFormat="24"
                #filterSearch
                (input)="(filterSearch)"
                [readonlyInput]="true"
              ></p-calendar>
            </th>
            <th>
              <p-calendar
                name="endTime"
                pattern="HH:mm"
                timeOnly="true"
                hourFormat="24"
                #filterSearch
                (input)="(filterSearch)"
                [readonlyInput]="true"
              ></p-calendar>
            </th>
          </tr>
          <tr *ngIf="route.expand" id="Titles">
            <th colspan="1"></th>
            <th>Veículo</th>
            <th>Data inicial</th>
            <th>Data final</th>
            <th>Hora inicial</th>
            <th>Hora final</th>
          </tr>
        </thead>
        <tbody *ngIf="route.expand">
          <ng-template
            ngFor
            let-schedule
            [ngForOf]="
              route.schedules | termFilter: filterSearch.value:filterSearch
            "
            let-igroup="index"
          >
            <tr *ngIf="route.expand">
              <td colspan="1"></td>
              <td
                class="titleGroup"
                [attr.rowspan]="schedule.rowsVehicle"
                *ngIf="schedule.showVehicle"
              >
                {{ schedule.vehicle.carPlate }}
              </td>
              <td
                class="titleGroup"
                [attr.rowspan]="schedule.rowsStartDate"
                *ngIf="schedule.showStartDate"
              >
                {{ schedule.startDate | date: 'dd/MM/yyyy' }}
              </td>

              <td
                class="titleGroup"
                [attr.rowspan]="schedule.rowsEndDate"
                *ngIf="schedule.showEndDate"
              >
                {{ schedule.endDate | date: 'dd/MM/yyyy' }}
              </td>
              <td>
                <p-calendar
                  name="startTime"
                  pattern="HH:mm"
                  timeOnly="true"
                  hourFormat="24"
                  (ngModelChange)="schedule.startTime = $event"
                  [ngModel]="schedule.startTime | dateconvert"
                  [readonlyInput]="true"
                  required
                ></p-calendar>
              </td>
              <td>
                <p-calendar
                  name="endTime"
                  pattern="HH:mm"
                  timeOnly="true"
                  (ngModelChange)="schedule.endTime = $event"
                  [ngModel]="schedule.endTime | dateconvert"
                  showTime="true"
                  hourFormat="24"
                  [readonlyInput]="true"
                  required
                ></p-calendar>
              </td>
            </tr>
          </ng-template>
          <!-- <td
                class="titleGroup"
                [attr.rowspan]="route.schedules | groupby: 'startDate'"
                *ngIf="igroup == 0"
              >
                {{ schedule.startDate | date: 'dd/MM/yyyy' }}
              </td>
              <td
                class="titleGroup"
                [attr.rowspan]="route.schedules | groupby: 'endDate'"
                *ngIf="igroup == 0"
              >
                {{ schedule.endDate | date: 'dd/MM/yyyy' }}
              </td> -->
          <!-- <td  class="titleGroup" rowspan="4" *ngIf="igroup == 0">
                  <p-calendar
                    name="startDate"
                    dateFormat="dd/mm/yy"
                    (ngModelChange)="schedule.startDate = $event"
                    [ngModel]="schedule.startDate | dateconvert"
                    [minDate]="minDateValue"
                    [maxDate]="maxDateValue"
                    [readonlyInput]="true"
                    required
                  ></p-calendar>
                </td> -->
          <!-- <td  class="titleGroup" [attr.rowspan]="group.value.length" *ngIf="igroup == 0">
                    {{group.key | date:'dd/MM/yyyy'}}
                </td> -->
          <!-- <td>
                <p-calendar
                  name="endDate"
                  dateFormat="dd/mm/yy"
                  (ngModelChange)="schedule.endDate = $event"
                  [ngModel]="schedule.endDate | dateconvert"
                  [minDate]="minDateValue"
                  [maxDate]="maxDateValue"
                  [readonlyInput]="true"
                  required
                ></p-calendar>
              </td>
            <td>
                <select required [(ngModel)]="schedule.vehicle" name="vehicle">
                  <option id="vehicle" *ngFor="let item of vehicles">{{
                    item.carPlate
                  }}</option>
                </select>
              </td>

            -->
          <!-- <td>
                <p-calendar
                  name="startTime"
                  pattern="HH:mm"
                  timeOnly="true"
                  (ngModelChange)="schedule.startTime = $event"
                  [ngModel]="schedule.startTime | dateconvert"
                  hourFormat="24"
                  [readonlyInput]="true"
                  required
                ></p-calendar>
              </td>
              <td>
                <p-calendar
                  name="endTime"
                  pattern="HH:mm"
                  timeOnly="true"
                  (ngModelChange)="schedule.endTime = $event"
                  [ngModel]="schedule.endTime | dateconvert"
                  showTime="true"
                  hourFormat="24"
                  [readonlyInput]="true"
                  required
                ></p-calendar>
              </td>

              <td>
                <button
                  (click)="removeSchedule(schedule)"
                  type="button"
                  class="btn btn-sm btn-danger"
                  data-toggle="button"
                  aria-pressed="false"
                  autocomplete="off"
                >
                  <i class="fa fa-trash"></i>
                </button>
              </td> -->

          <!-- <tr *ngIf="route.expand">
            <td colspan="9">
              <button
                type="submit"
                id="save"
                (click)="save(route)"
                class="btn btn-success col-md-12"
              >
                Salvar
              </button>
            </td>
          </tr>
          <tr *ngIf="route.expand">
            <td colspan="9">
              <button
                type="submit"
                id="remove"
                (click)="remove(route)"
                class="btn btn-danger col-md-12"
              >
                Remover rota
              </button>
            </td>
          </tr> -->
        </tbody>
        <pagination-controls
          (pageChange)="page = $event"
          previousLabel="Anterior"
          nextLabel="Próxima"
          autoHide="true"
          responsive="true"
          screenReaderPaginationLabel="Pagination"
        ></pagination-controls>
      </ng-template>
    </table>
  </div>
</div>
